{% extends "base.html" %}

{% block title %}{{ media.title }}{% endblock %}

{% block content %}
    <div class="banner" style="background-image: url('{{ url_for('static', filename='uploads/' + media.banner_img) if media.banner_img else '' }}');"></div>
    
    <div class="header-card {{ media.media_type }}-border">
        <div class="header-section">
            <div class="poster {% if media.media_type in ['album', 'single'] %}poster-square{% endif %}">
                {% if media.poster_img %}
                    <img src="{{ url_for('static', filename='uploads/' + media.poster_img) }}" alt="{{ media.title }} Poster">
                {% else %}
                    <div class="placeholder">?</div>
                {% endif %}
            </div>
            <div class="title-info">
                
                <h1>{{ media.title }}</h1>
                
                {% if media.tags %}
                <div class="tag-badge-container">
                    {% for tag in media.tags %}
                        <span class="tag-badge">{{ tag.name }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                {% if media.creator %}
                    <p class="creator">{{ media.creator }}</p>
                {% endif %}
                <p class="years">{{ media.years }}</p>
                
                <div class="score-display-container">
                    <div class="score-label">Official Score</div>
                    <div class="overall-score-box {{ get_rating_class(media.overall_score) }}">
                        {{ media.overall_score }}
                    </div>
                </div>

                {% if media.media_type in ['tv_show', 'album'] and media.calculated_average_score is not none %}
                <div class="calculated-avg">
                    (Average of parts: {{ media.calculated_average_score }})
                </div>
                {% endif %}

                {% if current_user.is_authenticated %}
                    <div class="admin-actions">
                        <a href="{{ url_for('main.edit_media', media_id=media.id) }}" class="btn btn-primary">Edit</a>
                        <form action="{{ url_for('main.delete_media', media_id=media.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this?');">
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    {% if media.media_type == 'tv_show' %}
        {% for season in media.seasons | sort(attribute='season_number') %}
            <div class="season-header">
                <h2>Season {{ season.season_number }}</h2>
                <div class="season-details">
                    {% if season.year %}<span class="season-year">{{ season.year }}</span>{% endif %}
                    {% if season.rating is not none %}
                        <div class="season-score-box {{ get_rating_class(season.rating) }}">
                            {{ season.rating }}
                        </div>
                    {% endif %}
                    <span class="season-avg">(Ep. Avg: {{ season.average_score }})</span>
                </div>
            </div>
            <div class="ratings-grid">
                {% for episode in season.episodes %}
                    <div class="rating-item {{ get_rating_class(episode.rating) }}" data-title="E{{ episode.episode_number }}: {{ episode.title }}">
                        {{ episode.rating if episode.rating is not none else 'N/A' }}
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    {% elif media.media_type == 'album' %}
        <h2 class="album-header">Tracks</h2>
        <div class="ratings-grid">
            {% for track in media.tracks | sort(attribute='track_number') %}
                <div class="rating-item {{ get_rating_class(track.rating) }}" data-title="T{{ track.track_number }}: {{ track.title }}">
                    {{ track.rating if track.rating is not none else 'N/A' }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

{% endblock %}
